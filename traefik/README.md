# Traefik Configuration

This directory contains Traefik configuration files for Stackyn.

## Structure

```
traefik/
├── traefik.yml          # Static configuration (entrypoints, providers, etc.)
├── dynamic/             # Dynamic configuration (routers, services, middlewares)
│   ├── routers.yml      # Routing rules
│   ├── middlewares.yml  # Middleware definitions
│   └── services.yml     # Backend service definitions
└── acme/                # Let's Encrypt certificates
    └── acme.json        # Auto-generated by Traefik
```

## Configuration Files

### traefik.yml (Static Config)

- **Entry Points**: Defines HTTP (80) and HTTPS (443) entry points
- **Providers**: Docker and File providers for service discovery
- **ACME**: Let's Encrypt configuration for SSL certificates
- **API**: Traefik dashboard configuration

### dynamic/routers.yml

Defines routing rules for:
- Frontend: `stackyn.local` or `staging.stackyn.com`
- Backend API: `api.stackyn.local` or `api.staging.stackyn.com`

### dynamic/middlewares.yml

Defines middleware for:
- Security headers
- CORS configuration
- Request/response headers

### dynamic/services.yml

Defines backend services:
- Frontend service (port 3000)
- Backend API service (port 8080)

## SSL Certificates

Traefik automatically manages SSL certificates via Let's Encrypt:
- Certificates are stored in `acme/acme.json`
- File permissions must be 600: `chmod 600 acme/acme.json`
- Certificates auto-renew before expiration

## Updating Configuration

1. **Static Config**: Edit `traefik.yml` and restart Traefik
2. **Dynamic Config**: Edit files in `dynamic/` - Traefik watches and reloads automatically

## Development vs Production

### Development
- Set `api.dashboard.insecure: true` in `traefik.yml`
- Use self-signed certificates or HTTP only
- Enable debug logging

### Production
- Set `api.dashboard.insecure: false`
- Use Let's Encrypt certificates
- Set proper email in ACME config
- Enable access logs

## Troubleshooting

### Check Traefik Logs
```bash
docker-compose logs -f traefik
```

### Verify Configuration
```bash
docker exec stackyn-traefik traefik version
docker exec stackyn-traefik traefik checkconfig
```

### Access Dashboard
- Development: `http://localhost:8080/dashboard/`
- Production: `https://traefik.staging.stackyn.com/dashboard/`

